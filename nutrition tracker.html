<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maathu Fitness тАУ Daily Food Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <h1 class="text-3xl font-bold text-center mb-4">ЁЯеЧ Daily Food & Nutrition Tracker</h1>

    <div class="bg-white p-4 rounded-xl shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-3">роЙрогро╡рпБ роЪрпЗро░рпНроХрпНроХ</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input id="foodTime" type="time" class="p-2 border rounded" />
            <input id="foodName" class="p-2 border rounded" placeholder="роЙрогро╡рпБ рокрпЖропро░рпН (Egg, Rice...)" />
            <input id="calorie" type="number" class="p-2 border rounded" placeholder="Calories (kcal)" />
            <input id="protein" type="number" class="p-2 border rounded" placeholder="Protein (g)" />
            <input id="carbs" type="number" class="p-2 border rounded" placeholder="Carbs (g)" />
            <input id="fat" type="number" class="p-2 border rounded" placeholder="Fat (g)" />
        </div>

        <button onclick="addFood()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-xl">Add Food</button>
    </div>

    <div id="foodList" class="bg-white p-4 rounded-xl shadow-lg mb-6 max-h-64 overflow-y-auto"></div>

    <div id="totals" class="bg-green-100 p-4 rounded-xl shadow-lg font-bold"></div>
    
    <div class="bg-white p-4 rounded-xl shadow-lg mt-6 mb-6">
        <h2 class="text-xl font-semibold mb-3">родрпЗродро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</h2>
        <input id="datePicker" type="date" class="p-2 border rounded w-full md:w-1/2" onchange="loadDataForSelectedDate()"/>
    </div>

    <div class="text-center mt-6">
        <button onclick="clearSelectedDay()" class="bg-red-600 text-white px-4 py-2 rounded-xl">родрпЗро░рпНроирпНродрпЖроЯрпБродрпНрод роиро╛ро│ро┐ройрпН Data Clear</button>
    </div>

<script>
// Global variable to hold the currently selected date key
let selectedDateKey;

// Load data array for the selected date
let foods = [];

// --- Date & Time Utilities ---

/**
 * родро▒рпНрокрпЛродрпИроп родрпЗродро┐ рооро▒рпНро▒рпБроорпН роирпЗро░родрпНродрпИ IST-ро▓рпН рокрпЖро▒рпБроХро┐ро▒родрпБ.
 */
function getISTDateKey() {
    const now = new Date();
    // Get the date string (YYYY-MM-DD) in IST
    const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Kolkata' };
    const dateParts = new Intl.DateTimeFormat('en-CA', dateOptions).formatToParts(now);
    const year = dateParts.find(p => p.type === 'year').value;
    const month = dateParts.find(p => p.type === 'month').value;
    const day = dateParts.find(p => p.type === 'day').value;
    return `${year}-${month}-${day}`;
}

/**
 * родро▒рпНрокрпЛродрпИроп роЗроирпНродро┐роп роирпЗро░родрпНродрпИ (IST) HH:MM (24-роорогро┐ роирпЗро░) ро╡роЯро┐ро╡родрпНродро┐ро▓рпН родро┐ро░рпБроорпНрок роЕро│ро┐роХрпНроХро┐ро▒родрпБ.
 */
function getISTTime24Hr() {
    const now = new Date();
    const formatter = new Intl.DateTimeFormat('en-IN', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false, 
        timeZone: 'Asia/Kolkata'
    });
    return formatter.format(now);
}

/**
 * 24-роорогро┐ роирпЗро░ роирпЗро░родрпНродрпИ 12-роорогро┐ роирпЗро░ AM/PM ро╡роЯро┐ро╡родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпНро▒рпБроХро┐ро▒родрпБ.
 */
function convertTo12HrIST(time24hr) {
    if (!time24hr || time24hr === 'N/A') return 'N/A';
    
    const [hours, minutes] = time24hr.split(':');
    let h = parseInt(hours, 10);
    const m = minutes;
    const ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12;
    h = h ? h : 12; 
    const displayHour = h < 10 ? '0' + h : h;
    
    return `${displayHour}:${m} ${ampm}`;
}

// --- Data Loading and Initialization ---

// рокроХрпНроХроорпН ро▓рпЛроЯрпН роЖройро╡рпБроЯройрпН, Date Picker-роР роЗройрпНро▒рпИроп IST родрпЗродро┐роХрпНроХрпБ роЕроорпИроХрпНроХро╡рпБроорпН.
document.addEventListener('DOMContentLoaded', () => {
    const todayIST = getISTDateKey();
    const datePicker = document.getElementById('datePicker');
    
    datePicker.value = todayIST;
    datePicker.max = todayIST; // роОродро┐ро░рпНроХро╛ро▓ родрпЗродро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХ роорпБроЯро┐ропро╛родрпБ.
    
    // роЖро░роорпНрокро┐роХрпНроХрпБроорпН рокрпЛродрпБ роЗройрпНро▒рпИроп родрпЗродро┐роХрпНроХро╛рой родро░ро╡рпИ роПро▒рпНро▒ро╡рпБроорпН.
    selectedDateKey = todayIST;
    loadDataForSelectedDate();
});

function loadDataForSelectedDate() {
    const datePickerValue = document.getElementById('datePicker').value;
    
    if (!datePickerValue) return;

    // родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯ родрпЗродро┐ропро┐ройрпН ро╡ро┐роЪрпИ (Key) роР рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
    selectedDateKey = datePickerValue;
    
    // роЕроирпНрод родрпЗродро┐роХрпНроХрпБро░ро┐роп роЙрогро╡рпБроХро│рпИ Local Storage-ро▓рпН роЗро░рпБроирпНродрпБ роПро▒рпНро▒ро╡рпБроорпН
    foods = JSON.parse(localStorage.getItem(`FOODS_${selectedDateKey}`)) || [];
    
    // роЙрогро╡рпБ роЪрпЗро░рпНроХрпНроХрпБроорпН роирпЗро░ роЙро│рпНро│рпАроЯрпНроЯрпИ родро▒рпНрокрпЛродрпИроп IST роирпЗро░родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН (роЕройрпНро▒рпИроп родрпЗродро┐ропро╛роХ роЗро░рпБроирпНродро╛ро▓рпН роороЯрпНроЯрпБроорпН)
    if (selectedDateKey === getISTDateKey()) {
        document.getElementById('foodTime').value = getISTTime24Hr();
    } else {
         // роорпБроирпНродрпИроп родрпЗродро┐ропро╛роХ роЗро░рпБроирпНродро╛ро▓рпН, роирпЗро░ роЙро│рпНро│рпАроЯрпНроЯрпИ роХро╛ро▓ро┐ропро╛роХ ро╡рпИродрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН
         document.getElementById('foodTime').value = '';
    }

    render();
}

// --- Main Logic ---

function addFood() {
    const enteredTime24Hr = document.getElementById('foodTime').value;

    const food = {
        // родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯ родрпЗродро┐ропро┐ро▓рпН, роЙрогро╡рпБ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпБроорпН роирпЗро░роорпН
        time: enteredTime24Hr || getISTTime24Hr(), 
        name: document.getElementById('foodName').value,
        calorie: parseFloat(document.getElementById('calorie').value) || 0,
        protein: parseFloat(document.getElementById('protein').value) || 0,
        carbs: parseFloat(document.getElementById('carbs').value) || 0,
        fat: parseFloat(document.getElementById('fat').value) || 0
    };

    if (!food.name) return alert("роЙрогро╡рпБ рокрпЖропро░рпН родрпЗро╡рпИ!");

    foods.push(food);
    foods.sort((a, b) => (a.time > b.time) ? 1 : ((b.time > a.time) ? -1 : 0)); 
    
    // родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯ родрпЗродро┐роХрпНроХрпБро░ро┐роп роЙрогро╡рпБроХро│рпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН
    localStorage.setItem(`FOODS_${selectedDateKey}`, JSON.stringify(foods));
    
    render();

    // Input роХро│рпИ clear роЪрпЖропрпНродрпБ, time роР родро▒рпНрокрпЛродрпИроп IST роирпЗро░родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпНро▒
    if (selectedDateKey === getISTDateKey()) {
        document.getElementById('foodTime').value = getISTTime24Hr(); 
    }
    document.getElementById('foodName').value = '';
    document.getElementById('calorie').value = '';
    document.getElementById('protein').value = '';
    document.getElementById('carbs').value = '';
    document.getElementById('fat').value = '';
}

function render() {
    const list = document.getElementById('foodList');
    list.innerHTML = `<h2 class="text-xl font-semibold mb-3">${selectedDateKey} роХрпНроХро╛рой роЙрогро╡рпБроХро│рпН</h2>`;

    if (foods.length === 0) {
        list.innerHTML += '<p class="text-gray-500">роЗройрпНройрпБроорпН Food Add роЪрпЖропрпНропро╡ро┐ро▓рпНро▓рпИ.</p>';
        document.getElementById('totals').innerHTML = '';
        return;
    }

    let totalCal = 0, totalP = 0, totalC = 0, totalF = 0;

    foods.forEach((f, i) => {
        totalCal += f.calorie;
        totalP += f.protein;
        totalC += f.carbs;
        totalF += f.fat;
        
        const displayTime = convertTo12HrIST(f.time);

        list.innerHTML += `
            <div class="border p-2 rounded-lg mb-2 flex justify-between">
                <div class="flex-1 min-w-0 mr-2"> 
                    <b class="break-words">${f.name}</b> <span class="text-sm text-gray-500">(${displayTime})</span><br>
                    <span class="text-sm">Cal: ${f.calorie} | P: ${f.protein} | C: ${f.carbs} | F: ${f.fat}</span>
                </div>
                <button onclick="deleteFoodConfirmation(${i}, '${f.name}')" class="text-red-600 font-bold flex-shrink-0">X</button>
            </div>
        `;
    });

    // роорпКродрпНрод роородро┐рокрпНрокрпБроХро│рпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
    document.getElementById('totals').innerHTML = `роорпКродрпНродроорпН: ЁЯН╜я╕П Calories: ${totalCal.toFixed(0)} | Protein: ${totalP.toFixed(1)}g | Carbs: ${totalC.toFixed(1)}g | Fat: ${totalF.toFixed(1)}g`;
}

// --- Delete/Clear Logic ---

// родройро┐рокрпНрокроЯрпНроЯ роЙрогро╡рпИ роирпАроХрпНроХрпБро╡родро▒рпНроХрпБ роорпБройрпН роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро▓рпН роХрпЗроЯрпНроХрпБроорпН рокрпБродро┐роп роГрокроЩрпНро╖ройрпН
function deleteFoodConfirmation(i, foodName) {
    if (confirm(`роЙро▒рпБродро┐ропро╛роХро╡ро╛, ${foodName} роР роирпАроХрпНроХ ро╡рпЗрогрпНроЯрпБрооро╛?`)) {
        // рокропройро░рпН 'Yes' роХрпКроЯрпБродрпНродро╛ро▓рпН, deleteFood роГрокроЩрпНро╖ройрпИ роЕро┤рпИроХрпНроХро┐ро▒родрпБ
        deleteFood(i);
    }
    // рокропройро░рпН 'No' роХрпКроЯрпБродрпНродро╛ро▓рпН, роОродрпБро╡рпБроорпН роироЯроХрпНроХро╛родрпБ (роГрокроЩрпНро╖ройрпН роорпБроЯро┐ро╡роЯрпИропрпБроорпН)
}

function deleteFood(i) {
    // роЙрогро╡рпИ роирпАроХрпНроХрпБроорпН ро▓ро╛роЬро┐роХрпН
    foods.splice(i, 1);
    localStorage.setItem(`FOODS_${selectedDateKey}`, JSON.stringify(foods));
    render();
}

function clearSelectedDay() {
    if (confirm(`роирпАроЩрпНроХро│рпН родрпЗро░рпНроирпНродрпЖроЯрпБродрпНрод роиро╛ро│ро┐ройрпН (${selectedDateKey}) Data роОро▓рпНро▓ро╛роорпН delete роЖроХрпБроорпН. роЙро▒рпБродро┐ропро╛роХро╡ро╛?`)) {
        // роЙрогро╡рпБроХро│рпИ роирпАроХрпНроХ
        localStorage.removeItem(`FOODS_${selectedDateKey}`);
        foods = [];
        render();
    }
}
</script>

</body>
</html>
